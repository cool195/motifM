"use strict";!function(a,t){function e(){a("#success").toggleClass("loading-hidden"),setTimeout(function(){a("#success").toggleClass("loading-open")},25)}function s(){a("#success").addClass("loading-close"),setTimeout(function(){a("#success").toggleClass("loading-hidden loading-open").removeClass("loading-close")},500)}function i(){a("#error").toggleClass("loading-hidden"),setTimeout(function(){a("#error").toggleClass("loading-open")},25)}function n(){a("#error").addClass("loading-close"),setTimeout(function(){a("#error").toggleClass("loading-hidden loading-open").removeClass("loading-close")},500)}function o(){a("#loading").toggleClass("loading-hidden"),setTimeout(function(){a("#loading").toggleClass("loading-open")},25)}function l(){a("#loading").addClass("loading-close"),setTimeout(function(){a("#loading").toggleClass("loading-hidden loading-open").removeClass("loading-close")},500)}function r(a){a.target.playVideo()}function d(a,t){return a=a.filter(function(a){return a!==t})}function c(a,t){return a.find(function(a){return a===t})}function u(a){for(var t=[],e=0;e<a.length;e++)0===a[e].stock_qtty&&t.push(a[e].sku);return t}function g(t,e,s){var i=s;a.each(t,function(a,t){for(var s=t,n=0;n<s.skuAttrValues.length;n++){for(var o=s.skuAttrValues[n],l=s.attr_type,r=o.attr_value_id,c=o.skus,u=0;u<e.length;u++)c=d(c,e[u]);void 0===i[l]&&(i[l]={}),i[l][r]=c}})}function h(t,e){a.each(t,function(a,t){0!==t.stock_qtty&&(e[t.sku]=t.stock_qtty)})}function m(t,e){a.each(t,function(a,t){var s=t.vas_id,i=t.vas_type;e[s]=i})}function f(t){var e=t;if(M=[],1===e.length){var s=a(t).data("spa"),i=a(t).data("ska");return void(M=D[s][i])}for(var n=[],o=0;o<e.length;o++){var l=a(e[o]).data("ska"),r=a(e[o]).data("spa");n.push(D[r][l])}for(var d=[],u=0;u<e.length;u++){var g=[];if(0!==u){for(var h=0;h<n[u].length;h++){var m=c(d,n[u][h]);void 0!==m&&g.push(m)}d=g}else d=n[u]}M=d}function v(t){a.each(t,function(t,e){var s=D[e];a.each(s,function(t,e){for(var s=e,i=!1,n=0;n<s.length&&!i;n++)for(var o=0;o<M.length;o++)if(s[n]===M[o]){i=!0;break}i===!1?(a("#"+t).addClass("disabled"),a("#"+t).removeClass("active")):a("#"+t).removeClass("disabled")})})}function p(t,e,s){var i=D[e][s];1===t.length?a(".btn-itemProperty[data-spa="+t[0]+"]").removeClass("disabled"):a.each(t,function(t,s){var n=D[s];s!==e&&a.each(n,function(t,e){for(var s=e,n=!1,o=0;o<s.length&&!n;o++)for(var l=0;l<i.length;l++)if(s[o]===i[l]){n=!0;break}n===!1?(a("#"+t).addClass("disabled"),a("#"+t).removeClass("active")):a("#"+t).removeClass("disabled")})})}function C(t){var e=Object.keys(D),s={};s.select=[],s.wait=[];for(var i=0;i<t.length;i++){var n=a(t[i]).data("spa");s.select.push(n),e=d(e,n.toString())}return s.wait=e,s}function y(t){var e=Object.keys(D);if(1!==e.length){var s={};a.each(e,function(e,i){var n=a(t[e]).data("ska"),o=a(t[e]).data("spa");s[i]=D[o][n]}),a.each(e,function(t,e){var i=[];a.each(s,function(a,t){if(e!==a){var s=[];if(0===i.length)s=t;else for(var n=0;n<t.length;n++){var o=c(i,t[n]);void 0!==o&&s.push(o)}i=s}}),a.each(D[e],function(t,e){for(var s=!1,n=0;n<i.length&&!s;n++)for(var o=0;o<e.length;o++)if(e[o]===i[n]){s=!0;break}s===!1?(a("#"+t).addClass("disabled"),a("#"+t).removeClass("active")):a("#"+t).removeClass("disabled")})})}}function b(){var t=a(".btn-itemProperty.active"),e="";t.length>0?(a.each(t,function(a,s){e+=a===t.length-1?s.textContent.trim():s.textContent.trim()+","}),a("[data-select]").text("Selected:")):a("[data-select]").text("Select")}function k(t){a.each(N,function(e,s){if(t==s.sku)return a("#skuNewPrice").html("$"+(s.skuPrice.sale_price/100).toFixed(2)),!1})}function w(t,e){var s=a(".warning-info");o(),a.ajax({url:"/stock/checkstock",data:{skus:t}}).done(function(a){if(a.success){var t=!0,i=parseInt(e.siblings("[data-num]").html());t=1===a.data.list[0].stockStatus,t===!1&&(s.removeClass("off"),s.children("span").html("Warning: Only "+i+" left"),e.addClass("disabled"))}}).always(function(){l()})}function T(){a.ajax({url:" /cart/amount",type:"GET"}).done(function(t){t.success&&(t.data.skusAmout>0&&t.data.skusAmout<=99?(a(".nav-shoppingCart").children("span").show(),a(".nav-shoppingCart").children("span").html(t.data.skusAmout)):t.data.skusAmout>99?(a(".nav-shoppingCart").children("span").show(),a(".nav-shoppingCart").children("span").html("99+")):a(".nav-shoppingCart").children("span").hide())})}function x(t){1!=a("#addToCart-sku").val()&&(M[0]=a("#addToCart-sku").val());var r=a("#item-count").children("[data-num]").html(),d={sale_qtty:r,select:!0,sku:M[0],VAList:[]};a("#addToCart-sku").val(M[0]);var c=0,u=[];a.each(G,function(t,e){var s=a("#"+t);if(s.hasClass("active")){switch(u[c]={},u[c].vas_id=t,u[c].user_remark="",e){case 1:var i=s.siblings(".input-engraving").val();u[c].user_remark=i;break;case 2:}c++}}),onAddToCart(),d.VAList=u,o(),a.ajax({url:"/cart",type:t,data:{operate:d}}).done(function(o){o.success?(T(),a("[data-role]").removeClass("disabled"),""!==o.redirectUrl&&(window.location.href=o.redirectUrl),"PATCH"===t&&(e(),setTimeout(function(){s()},1500)),_(),I(),a(".header-shoppingBag").addClass("active"),setTimeout(function(){a(".header-shoppingBag").removeClass("active")},3e3)):(a("#error-info").text(o.error_msg),i(),setTimeout(function(){n()},1500))}).always(function(){l()})}function I(){var t=a("#userEmail").val(),e=e||[];e.push(["identify",{$email:t}]),trackAddToBag()}function _(){a.ajax({url:"/cart/list"}).done(function(t){A(t.data);var e=(t.data.total_amount/100).toFixed(2),s=t.data.total_sku_qtty;a("#headerBag-subTotal").html(e),a("#itemNum").html(s)})}function A(t){var e=template("tpl-headerBag",t),s=a.parseHTML(e);a(".headerBag-list").html(s),a("img.img-lazy").lazyload({threshold:200,container:a(".headerBag-list"),effect:"fadeIn"}),a(".headerCartList").length<=0&&a(".headerBag-list").html('<div class="text-center">Your bag is empty. Fill it up</div>')}function P(){var t=!0,e="";if(a(".sparow").each(function(s){0!=a(this).data("click")&&"false"!=a(this).data("click")||(t=!1,e+=a(this).data("msg")+",")}),t)return!0;var s=a("#modalDialog").offset().top;return a("html, body").animate({"scroll-top":s-85},"fast"),a("#selectspa").html(e.substring(0,e.length-1)+" not selected"),a("#selectmsg").removeClass("loading-hidden"),setTimeout(function(){a("#selectmsg").addClass("loading-hidden")},1500),!1}function B(a){for(var t="",e=0;e<a.length;e++)a.charCodeAt(e)>0&&a.charCodeAt(e)<255&&(t+=a.charAt(e));return t}function j(a){for(var t=B(a.val()),e=/^([a-z_A-Z-\/+0-9+\s]+)$/i,s=0;s<t.length;s++){var i=t.charAt(s);e.test(i)||(t=t.replace(i,""))}a.val(t)}function z(t){var e=window.setInterval(function(){t<=1&&(a(".limited-title").html("<strong>Pre Sale has ended</strong>"),a(".stock-qtty").html("Sold Out"),a("#limited-progress").attr("value","0"),a(".up-btn-addToBag").addClass("disabled"),a(".down-btn-addToBag").addClass("disabled"),clearInterval(e));var s=0,i=0,n=0,o=0;t>0&&(s=Math.floor(t/86400),i=Math.floor(t/3600)-24*s,n=Math.floor(t/60)-24*s*60-60*i,o=Math.floor(t)-24*s*60*60-60*i*60-60*n),U<2592e5?a(".time_show").html(24*s+i+"h: "+n+"m: "+o+"s"):a(".time_show").html(s+"d: "+i+"h: "+n+"m: "+o+"s"),t--,Y=1e4*(1e3*t/W).toFixed(4),a("#limited-progress").attr("value",Y)},1e3)}var O=new t("#baseImg-swiper",{pagination:"#baseImg-pagination",paginationType:"fraction",loop:!0,lazyLoading:!0,lazyLoadingInPrevNext:!0}),L=new t("#detailImg-swiper",{pagination:"#detailImg-pagination",paginationType:"fraction",loop:!0,lazyLoading:!0,lazyLoadingInPrevNext:!0}),M=(new t("#recommend-productList",{slidesPerView:2.5,paginationClickable:!0,spaceBetween:1,freeMode:!0,lazyLoading:!0,lazyLoadingInPrevNext:!0}),[]);1==[1==a(".sparow").length&&a(".skarow").length]&&(a(".sparow").data("click",!0),a(".skarow").addClass("active"),M[0]=a("[data-onlysku]").data("onlysku"),a("[data-select]").text("Selected:"));var S=[],E=[];L.params.control=O,O.params.control=L,a(".product-baseImg").on("click",function(){a(".product-detailImg").addClass("in"),a("body").addClass("no-scroll")}),a(".product-detailImg").on("click",function(){a(this).removeClass("in"),a("body").removeClass("no-scroll")}),a(function(){var a=document.createElement("script");a.src="https://www.youtube.com/player_api";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(a,t)}),a(".btn-productPlayer").on("click",function(){var t=a(this).data("ytbid");a("#ytplayer").data("playid",t),a(".product-detailPlay").addClass("in"),a("body").addClass("no-scroll");var e=9/16,s=a(window).width(),i=s*e;a(".play-content").css("height",i);var n,o=a("#ytplayer"),t=o.data("playid");n=new YT.Player("ytplayer",{height:i,width:s,videoId:t,playerVars:{autoplay:1,controls:2,showinfo:0,rel:0},events:{onReady:r}})}),a(".product-detailPlay").on("click",function(){a(this).removeClass("in"),a("body").removeClass("no-scroll"),a(".product-detailImg").removeClass("in"),a(".play-content").html('<div id="ytplayer" class="ytplayer" data-playid=""></div>')});var N,q={closeOnOutsideClick:!1,closeOnCancel:!1,hashTracking:!1},V=a("[data-remodal-id=modal]").remodal(q),D={},F={},G={};!function(){var t=a("#modalDialog").data("spu");a.ajax({async:!1,url:"/products/"+t}).done(function(a){if(a.success){N=a.data.skuExps;var t=E=u(a.data.skuExps);void 0===a.data.spuAttrs||""==a.data.spuAttrs?M=a.data.skus:(S=a.data.spuAttrs,g(a.data.spuAttrs,t,D)),h(a.data.skuExps,F),m(a.data.vasBases,G)}})}(),a(".btn-itemProperty").on("click",function(t){var e=a(".warning-info");e.hasClass("off")||e.addClass("off");var s=a(t.target).data("spa"),i=a(t.target).data("ska");if(!a(t.target).hasClass("disabled")){a(t.target).hasClass("active")?(a("#spa"+s).data("click","false"),a(t.target).removeClass("active")):(a(t.target).parents(".row").find(".btn-itemProperty").removeClass("active"),a("#spa"+s).data("click","true"),a(t.target).addClass("active")),b();var n=a("#modalDialog").find(".btn-itemProperty.active"),o=Object.keys(D),l=a("#item-count"),r=C(n);if(l.children('[data-num="num"]').html(1),n.length===o.length){f(n),y(n);var d=F[M[0]];l.children('[data-item="minus"]').addClass("disabled"),l.children('[data-num="num"]').html(1),d>1&&l.children('[data-item="add"]').removeClass("disabled")}else n.length<1?(g(S,E,D),M=[]):(f(n),v(r.wait),p(r.select,s,i));void 0!=M[0]&&(a("#addToCart-sku").val(M[0]),k(M[0]));var c=a(this).data("image"),u=!1;void 0!=c&&""!=c&&(a.each(a("#baseImg-swiper img.swiper-lazy"),function(t,e){var s=a(this).attr("src");if(s===c)return O.slideTo(t,1e3,!1),L.slideTo(t,1e3,!1),u=!0,!1}),u===!1&&(O.slides[1].className.indexOf("replace-img")>0?(a(".img-replace").attr("src",c),O.slideTo(1,1e3,!1),L.slideTo(1,1e3,!1)):(O.prependSlide('<div class="swiper-slide replace-img"><img class="img-fluid swiper-lazy img-replace" data-src="'+c+'" alt=""><img class="img-fluid preloader" src="/images/product/bg-product@750.png" alt=""></div>'),O.slideTo(1,1e3,!1),L.prependSlide('<div class="swiper-slide replace-img"><img class="img-fluid swiper-lazy img-replace" data-src="'+c+'" alt=""><img class="img-fluid preloader" src="/images/product/bg-product@750.png" alt=""></div>'),L.slideTo(1,1e3,!1))))}}),a("#item-count").on("click","[data-item]",function(t){if(!P())return!1;var e=a(".warning-info"),s=a("#modalDialog").find(".btn-itemProperty.active"),i=Object.keys(D);if(!(i.length<s.length)){var n;if(n="I"===a(t.target)[0].tagName?a(t.target).parents(".btn-cartCount"):a(t.target),!n.hasClass("disabled")){var o=parseInt(n.siblings("[data-num]").html()),l=M[0],r=F[l],d=o++,c=d;if("add"===n.data("item")){c=o;var u=50;if(o>1&&n.siblings('[data-item="minus"]').removeClass("disabled"),o===u&&(e.removeClass("off"),e.children("span").html("50 items limit"),n.addClass("disabled")),r<20)o===r&&(e.removeClass("off"),e.children("span").html("Warning: Only "+o+" left"),n.addClass("disabled"));else if(20===r&&o>=20){var g=l+"_"+ ++o;w(g,n)}}else--d,e.addClass("off"),1===d?n.addClass("disabled"):n.siblings('[data-item="add"]').hasClass("disabled")&&n.siblings('[data-item="add"]').removeClass("disabled"),c=d;a("#addToCart-quantity").val(c),n.siblings("[data-num]").html(c)}}}),a('[data-role="continue"]').on("click",function(t){if(100!=a("#modalDialog").data("status"))return a("#error-info").text("not invalid"),i(),setTimeout(function(){n()},1500),!1;if(1!=a("#addToCart-sku").val()&&1!=a("#modalDialog").data("login"))x("PATCH");else if(P()){var e=a(t.target).data("action");x(e)}}),a('[data-control="openModal"]').on("click",function(t){if(!a(this).hasClass("disabled")){var e=Object.keys(D),s=Object.keys(G),i=a(t.target).data("action");0===e.length&&0===s.length&&0!==M.length?x(i):(a('[data-control="continue"]').removeClass("hidden-xs-up"),a('[data-control="modalButton"]').addClass("hidden-xs-up"),V.open(),a('[data-role="continue"]').data("action",i))}}),a("[data-remodal-id=modal]").on("closed",function(){a('[data-control="continue"]').addClass("hidden-xs-up"),a('[data-control="modalButton"]').removeClass("hidden-xs-up")}),a("fieldset[data-vas-type]").on("click",function(t){if(1===parseInt(a(this).data("vas-type")))if(a(t.target).hasClass("icon-checkcircle")){var e=a(t.target),s=a(t.target).siblings(".input-engraving");e.hasClass("active")?(s.addClass("disabled"),e.removeClass("active"),s.val("")):(s.removeClass("disabled"),e.addClass("active"))}else if(a(t.target).hasClass("input-engraving")){var e=a(t.target).siblings(".icon-checkcircle"),s=a(t.target);s.hasClass("disabled")&&(s.removeClass("disabled"),e.addClass("active"),s.val(""))}}),a(".input-engraving").on("keyup blur",function(){j(a(this))}),a(".btn-showMore").on("click",function(){var t=a(this).siblings(".message-info");t.toggleClass("active"),t.hasClass("active")?(a(this).addClass("off"),a(this).children(".showMore").html("Show Less"),a(this).children(".iconfont").removeClass("icon-arrow-bottom").addClass("icon-arrow-up")):(a(this).removeClass("off"),a(this).children(".showMore").html("Show More"),a(this).children(".iconfont").removeClass("icon-arrow-up").addClass("icon-arrow-bottom"))}),a(document).ready(function(){a(".message-info").children("p").height()<=64&&a(".btn-showMore").hide(),a("img.img-lazy").lazyload({threshold:200,effect:"fadeIn"}),a.ajax({url:a(".product-baseInfo").data("impr"),type:"GET"}),a.ajax({url:a("#recommend").data("impr"),type:"GET"})});var H=a(".limited-content").data("begintime"),$=a(".limited-content").data("endtime"),U=a(".limited-content").data("lefttime"),W=(a(".limited-content").data("qtty"),parseInt($-H)),Y=1e4*(U/W).toFixed(4);a("#limited-progress").attr("value",Y),U!=-1&&a(function(){z(U/1e3)})}(jQuery,Swiper);