"use strict";var BaseImgSwiper,DetailImgSwiper;!function(a,e){function t(){a("#success").toggleClass("loading-hidden"),setTimeout(function(){a("#success").toggleClass("loading-open")},25)}function s(){a("#success").addClass("loading-close"),setTimeout(function(){a("#success").toggleClass("loading-hidden loading-open").removeClass("loading-close")},500)}function i(){a("#error").toggleClass("loading-hidden"),setTimeout(function(){a("#error").toggleClass("loading-open")},25)}function n(){a("#error").addClass("loading-close"),setTimeout(function(){a("#error").toggleClass("loading-hidden loading-open").removeClass("loading-close")},500)}function o(){a("#loading").toggleClass("loading-hidden"),setTimeout(function(){a("#loading").toggleClass("loading-open")},25)}function l(){a("#loading").addClass("loading-close"),setTimeout(function(){a("#loading").toggleClass("loading-hidden loading-open").removeClass("loading-close")},500)}function r(a){a.target.playVideo()}function d(a,e){return a=a.filter(function(a){return a!==e})}function c(a,e){return a.find(function(a){return a===e})}function u(a){for(var e=[],t=0;t<a.length;t++)0===a[t].stock_qtty&&e.push(a[t].sku);return e}function g(e,t,s){var i=s;a.each(e,function(a,e){for(var s=e,n=0;n<s.skuAttrValues.length;n++){for(var o=s.skuAttrValues[n],l=s.attr_type,r=o.attr_value_id,c=o.skus,u=0;u<t.length;u++)c=d(c,t[u]);void 0===i[l]&&(i[l]={}),i[l][r]=c}})}function m(e,t){a.each(e,function(a,e){0!==e.stock_qtty&&(t[e.sku]=e.stock_qtty)})}function h(e,t){a.each(e,function(a,e){var s=e.vas_id,i=e.vas_type;t[s]=i})}function p(e){var t=e;if(z=[],1===t.length){var s=a(e).data("spa"),i=a(e).data("ska");return void(z=N[s][i])}for(var n=[],o=0;o<t.length;o++){var l=a(t[o]).data("ska"),r=a(t[o]).data("spa");n.push(N[r][l])}for(var d=[],u=0;u<t.length;u++){var g=[];if(0!==u){for(var m=0;m<n[u].length;m++){var h=c(d,n[u][m]);void 0!==h&&g.push(h)}d=g}else d=n[u]}z=d}function f(e){a.each(e,function(e,t){var s=N[t];a.each(s,function(e,t){for(var s=t,i=!1,n=0;n<s.length&&!i;n++)for(var o=0;o<z.length;o++)if(s[n]===z[o]){i=!0;break}i===!1?(a("#"+e).addClass("disabled"),a("#"+e).removeClass("active")):a("#"+e).removeClass("disabled")})})}function v(e,t,s){var i=N[t][s];1===e.length?a(".btn-itemProperty[data-spa="+e[0]+"]").removeClass("disabled"):a.each(e,function(e,s){var n=N[s];s!==t&&a.each(n,function(e,t){for(var s=t,n=!1,o=0;o<s.length&&!n;o++)for(var l=0;l<i.length;l++)if(s[o]===i[l]){n=!0;break}n===!1?(a("#"+e).addClass("disabled"),a("#"+e).removeClass("active")):a("#"+e).removeClass("disabled")})})}function C(e){var t=Object.keys(N),s={};s.select=[],s.wait=[];for(var i=0;i<e.length;i++){var n=a(e[i]).data("spa");s.select.push(n),t=d(t,n.toString())}return s.wait=t,s}function y(e){var t=Object.keys(N);if(1!==t.length){var s={};a.each(t,function(t,i){var n=a(e[t]).data("ska"),o=a(e[t]).data("spa");s[i]=N[o][n]}),a.each(t,function(e,t){var i=[];a.each(s,function(a,e){if(t!==a){var s=[];if(0===i.length)s=e;else for(var n=0;n<e.length;n++){var o=c(i,e[n]);void 0!==o&&s.push(o)}i=s}}),a.each(N[t],function(e,t){for(var s=!1,n=0;n<i.length&&!s;n++)for(var o=0;o<t.length;o++)if(t[o]===i[n]){s=!0;break}s===!1?(a("#"+e).addClass("disabled"),a("#"+e).removeClass("active")):a("#"+e).removeClass("disabled")})})}}function b(){var e=a(".btn-itemProperty.active"),t="";e.length>0?(a.each(e,function(a,s){t+=a===e.length-1?s.textContent.trim():s.textContent.trim()+","}),a("[data-select]").text("Selected:")):a("[data-select]").text("Select")}function w(e){a.each(L,function(t,s){if(e==s.sku)return a("#skuNewPrice").html("$"+(s.skuPrice.sale_price/100).toFixed(2)),!1})}function k(e,t){var s=a(".warning-info");o(),a.ajax({url:"/stock/checkstock",data:{skus:e}}).done(function(a){if(a.success){var e=!0,i=parseInt(t.siblings("[data-num]").html());e=1===a.data.list[0].stockStatus,e===!1&&(s.removeClass("off"),s.children("span").html("Warning: Only "+i+" left"),t.addClass("disabled"))}}).always(function(){l()})}function I(){a.ajax({url:" /cart/amount",type:"GET"}).done(function(e){e.success&&(e.data.skusAmout>0&&e.data.skusAmout<=99?(a(".nav-shoppingCart").children("span").show(),a(".nav-shoppingCart").children("span").html(e.data.skusAmout)):e.data.skusAmout>99?(a(".nav-shoppingCart").children("span").show(),a(".nav-shoppingCart").children("span").html("99+")):a(".nav-shoppingCart").children("span").hide())})}function T(e){1!=a("#addToCart-sku").val()&&(z[0]=a("#addToCart-sku").val());var r=a("#item-count").children("[data-num]").html(),d={sale_qtty:r,select:!0,sku:z[0],VAList:[]};a("#addToCart-sku").val(z[0]);var c=0,u=[];a.each(V,function(e,t){var s=a("#"+e);if(s.hasClass("active")){switch(u[c]={},u[c].vas_id=e,u[c].user_remark="",t){case 1:var i=s.siblings(".input-engraving").val();u[c].user_remark=i;break;case 2:}c++}}),onAddToCart(),d.VAList=u,o(),a.ajax({url:"/cart",type:e,data:{operate:d}}).done(function(o){o.success?(I(),a("[data-role]").removeClass("disabled"),""!==o.redirectUrl&&(window.location.href=o.redirectUrl),"PATCH"===e&&(t(),setTimeout(function(){s()},1500)),S(),x(),a(".header-shoppingBag").addClass("active"),setTimeout(function(){a(".header-shoppingBag").removeClass("active")},3e3)):(a("#error-info").text(o.error_msg),i(),setTimeout(function(){n()},1500),(o.code=1707)&&(window.location.href="/login"))}).always(function(){l()})}function x(){var e=a("#userEmail").val(),t=t||[];t.push(["identify",{$email:e}]),trackAddToBag()}function S(){a.ajax({url:"/cart/list"}).done(function(e){B(e.data);var t=(e.data.total_amount/100).toFixed(2),s=e.data.total_sku_qtty;a("#headerBag-subTotal").html(t),a("#itemNum").html(" ("+s+" items)")})}function B(e){var t=template("tpl-headerBag",e),s=a.parseHTML(t);a(".headerBag-list").html(s),a("img.img-lazy").lazyload({threshold:200,container:a(".headerBag-list"),effect:"fadeIn"}),a(".headerCartList").length<=0&&a(".headerBag-list").html('<div class="text-center">Your bag is empty. Fill it up</div>')}function _(){var e=!0,t="";if(a(".sparow").each(function(s){0!=a(this).data("click")&&"false"!=a(this).data("click")||(e=!1,t+=a(this).data("msg")+",")}),e)return!0;var s=a("#modalDialog").offset().top;return a("html, body").animate({"scroll-top":s-85},"fast"),a("#selectspa").html(t.substring(0,t.length-1)+" not selected"),a("#selectmsg").removeClass("loading-hidden"),setTimeout(function(){a("#selectmsg").addClass("loading-hidden")},1500),!1}function A(a){for(var e="",t=0;t<a.length;t++)a.charCodeAt(t)>0&&a.charCodeAt(t)<255&&(e+=a.charAt(t));return e}function P(a){for(var e=A(a.val()),t=/^([a-z_A-Z-\/+0-9+\s]+)$/i,s=0;s<e.length;s++){var i=e.charAt(s);t.test(i)||(e=e.replace(i,""))}a.val(e)}function j(e){var t=window.setInterval(function(){e<=1&&(a(".limited-title").html("<strong>Pre Sale has ended</strong>"),a(".stock-qtty").html("Sold Out"),a("#limited-progress").attr("value","0"),a(".up-btn-addToBag").addClass("disabled"),a(".down-btn-addToBag").addClass("disabled"),clearInterval(t));var s=0,i=0,n=0,o=0;e>0&&(s=Math.floor(e/86400),i=Math.floor(e/3600)-24*s,n=Math.floor(e/60)-24*s*60-60*i,o=Math.floor(e)-24*s*60*60-60*i*60-60*n),H<2592e5?a(".time_show").html(24*s+i+"h: "+n+"m: "+o+"s"):a(".time_show").html(s+"d: "+i+"h: "+n+"m: "+o+"s"),e--,U=1e4*(1e3*e/$).toFixed(4),a("#limited-progress").attr("value",U)},1e3)}BaseImgSwiper=new e("#baseImg-swiper",{pagination:"#baseImg-pagination",paginationClickable:!0,loop:!0,lazyLoading:!0,lazyLoadingInPrevNext:!0,observer:!0}),a("#baseImg-pagination").click(function(a){var a=a||event;a.stopPropagation()}),DetailImgSwiper=new e("#detailImg-swiper",{pagination:"#detailImg-pagination",paginationType:"fraction",loop:!0,lazyLoading:!0,lazyLoadingInPrevNext:!0,observer:!0});var z=(new e("#recommend-productList",{slidesPerView:2.5,paginationClickable:!0,spaceBetween:1,freeMode:!0,lazyLoading:!0,lazyLoadingInPrevNext:!0}),[]);1==[1==a(".sparow").length&&a(".skarow").length]&&(a(".sparow").data("click",!0),a(".skarow").addClass("active"),z[0]=a("[data-onlysku]").data("onlysku"),a("[data-select]").text("Selected:"));var D=[],O=[];DetailImgSwiper.params.control=BaseImgSwiper,BaseImgSwiper.params.control=DetailImgSwiper,a(".product-baseImg").on("click",function(){a(".product-detailImg").addClass("in"),a("body").addClass("no-scroll")}),a(".product-detailImg").on("click",function(){a(this).removeClass("in"),a("body").removeClass("no-scroll")}),a(function(){var a=document.createElement("script");a.src="https://www.youtube.com/player_api";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(a,e)}),a(".btn-productPlayer").on("click",function(){var e=a(this).data("ytbid");a("#ytplayer").data("playid",e),a(".product-detailPlay").addClass("in"),a("body").addClass("no-scroll");var t=9/16,s=a(window).width(),i=s*t;a(".play-content").css("height",i);var n,o=a("#ytplayer"),e=o.data("playid");n=new YT.Player("ytplayer",{height:i,width:s,videoId:e,playerVars:{autoplay:1,controls:2,showinfo:0,rel:0},events:{onReady:r}})}),a(".product-detailPlay").on("click",function(){a(this).removeClass("in"),a("body").removeClass("no-scroll"),a(".product-detailImg").removeClass("in"),a(".play-content").html('<div id="ytplayer" class="ytplayer" data-playid=""></div>')});var L,M={closeOnOutsideClick:!1,closeOnCancel:!1,hashTracking:!1},E=a("[data-remodal-id=modal]").remodal(M),N={},q={},V={};!function(){var e=a("#modalDialog").data("spu");a.ajax({async:!1,url:"/products/"+e}).done(function(a){if(a.success){L=a.data.skuExps;var e=O=u(a.data.skuExps);void 0===a.data.spuAttrs||""==a.data.spuAttrs?z=a.data.skus:(D=a.data.spuAttrs,g(a.data.spuAttrs,e,N)),m(a.data.skuExps,q),h(a.data.vasBases,V)}})}(),a(".btn-itemProperty").on("click",function(e){var t=a(".warning-info");t.hasClass("off")||t.addClass("off");var s=a(e.target).data("spa"),i=a(e.target).data("ska");if(!a(e.target).hasClass("disabled")){a(e.target).hasClass("active")?(a("#spa"+s).data("click","false"),a(e.target).removeClass("active")):(a(e.target).parents(".row").find(".btn-itemProperty").removeClass("active"),a("#spa"+s).data("click","true"),a(e.target).addClass("active")),b();var n=a("#modalDialog").find(".btn-itemProperty.active"),o=Object.keys(N),l=a("#item-count"),r=C(n);if(l.children('[data-num="num"]').html(1),n.length===o.length){p(n),y(n);var d=q[z[0]];l.children('[data-item="minus"]').addClass("disabled"),l.children('[data-num="num"]').html(1),d>1&&l.children('[data-item="add"]').removeClass("disabled")}else n.length<1?(g(D,O,N),z=[]):(p(n),f(r.wait),v(r.select,s,i));void 0!=z[0]&&(a("#addToCart-sku").val(z[0]),w(z[0]));var c=a(this).data("image"),u=!1;void 0!=c&&""!=c&&(a.each(a("#baseImg-swiper img.swiper-lazy"),function(e,t){var s=a(this).attr("src");if(s===c)return BaseImgSwiper.slideTo(e,1e3,!1),DetailImgSwiper.slideTo(e,1e3,!1),u=!0,!1}),u===!1&&(BaseImgSwiper.slides[1].className.indexOf("replace-img")>0?(a(".img-replace").attr("src",c),BaseImgSwiper.slideTo(1,1e3,!1),DetailImgSwiper.slideTo(1,1e3,!1)):(BaseImgSwiper.prependSlide('<div class="swiper-slide replace-img"><img class="img-fluid swiper-lazy img-replace" data-src="'+c+'" alt=""><img class="img-fluid preloader" src="/images/product/bg-product@750.png" alt=""></div>'),BaseImgSwiper.slideTo(1,1e3,!1),DetailImgSwiper.prependSlide('<div class="swiper-slide replace-img"><img class="img-fluid swiper-lazy img-replace" data-src="'+c+'" alt=""><img class="img-fluid preloader" src="/images/product/bg-product@750.png" alt=""></div>'),DetailImgSwiper.slideTo(1,1e3,!1))))}}),a("#item-count").on("click","[data-item]",function(e){if(!_())return!1;var t=a(".warning-info"),s=a("#modalDialog").find(".btn-itemProperty.active"),i=Object.keys(N);if(!(i.length<s.length)){var n;if(n="I"===a(e.target)[0].tagName?a(e.target).parents(".btn-cartCount"):a(e.target),!n.hasClass("disabled")){var o=parseInt(n.siblings("[data-num]").html()),l=z[0],r=q[l],d=o++,c=d;if("add"===n.data("item")){c=o;var u=50;if(o>1&&n.siblings('[data-item="minus"]').removeClass("disabled"),o===u&&(t.removeClass("off"),t.children("span").html("50 items limit"),n.addClass("disabled")),r<20)o===r&&(t.removeClass("off"),t.children("span").html("Warning: Only "+o+" left"),n.addClass("disabled"));else if(20===r&&o>=20){var g=l+"_"+ ++o;k(g,n)}}else--d,t.addClass("off"),1===d?n.addClass("disabled"):n.siblings('[data-item="add"]').hasClass("disabled")&&n.siblings('[data-item="add"]').removeClass("disabled"),c=d;a("#addToCart-quantity").val(c),n.siblings("[data-num]").html(c)}}}),a('[data-role="continue"]').on("click",function(e){if(100!=a("#modalDialog").data("status"))return a("#error-info").text("not invalid"),i(),setTimeout(function(){n()},1500),!1;if(1!=a("#addToCart-sku").val()&&1!=a("#modalDialog").data("login"))T("PATCH");else if(_()){var t=a(e.target).data("action");T(t)}}),a('[data-control="openModal"]').on("click",function(e){if(!a(this).hasClass("disabled")){var t=Object.keys(N),s=Object.keys(V),i=a(e.target).data("action");0===t.length&&0===s.length&&0!==z.length?T(i):(a('[data-control="continue"]').removeClass("hidden-xs-up"),a('[data-control="modalButton"]').addClass("hidden-xs-up"),E.open(),a('[data-role="continue"]').data("action",i))}}),a("[data-remodal-id=modal]").on("closed",function(){a('[data-control="continue"]').addClass("hidden-xs-up"),a('[data-control="modalButton"]').removeClass("hidden-xs-up")}),a("fieldset[data-vas-type]").on("click",function(e){if(1===parseInt(a(this).data("vas-type")))if(a(e.target).hasClass("icon-checkcircle")){var t=a(e.target),s=a(e.target).siblings(".input-engraving");t.hasClass("active")?(s.addClass("disabled"),t.removeClass("active"),s.val("")):(s.removeClass("disabled"),t.addClass("active"))}else if(a(e.target).hasClass("input-engraving")){var t=a(e.target).siblings(".icon-checkcircle"),s=a(e.target);s.hasClass("disabled")&&(s.removeClass("disabled"),t.addClass("active"),s.val(""))}}),a(".input-engraving").on("keyup blur",function(){P(a(this))}),a(".btn-showMore").on("click",function(){var e=a(this).siblings(".message-info");e.toggleClass("active"),e.hasClass("active")?(a(this).addClass("off"),a(this).children(".showMore").html("Show Less"),a(this).children(".iconfont").removeClass("icon-arrow-bottom").addClass("icon-arrow-up")):(a(this).removeClass("off"),a(this).children(".showMore").html("Show More"),a(this).children(".iconfont").removeClass("icon-arrow-up").addClass("icon-arrow-bottom"))}),a(document).ready(function(){a(".message-info").children("p").height()<=64&&a(".btn-showMore").hide(),a("img.img-lazy").lazyload({threshold:200,effect:"fadeIn"}),a.ajax({url:a(".product-baseInfo").data("impr"),type:"GET"}),a.ajax({url:a("#recommend").data("impr"),type:"GET"})});var F=a(".limited-content").data("begintime"),G=a(".limited-content").data("endtime"),H=a(".limited-content").data("lefttime"),$=(a(".limited-content").data("qtty"),parseInt(G-F)),U=1e4*(H/$).toFixed(4);a("#limited-progress").attr("value",U),H!=-1&&a(function(){j(H/1e3)})}(jQuery,Swiper);