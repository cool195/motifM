"use strict";!function(a,t){function e(){a("#success").toggleClass("loading-hidden"),setTimeout(function(){a("#success").toggleClass("loading-open")},25)}function s(){a("#success").addClass("loading-close"),setTimeout(function(){a("#success").toggleClass("loading-hidden loading-open").removeClass("loading-close")},500)}function n(){a("#error").toggleClass("loading-hidden"),setTimeout(function(){a("#error").toggleClass("loading-open")},25)}function i(){a("#error").addClass("loading-close"),setTimeout(function(){a("#error").toggleClass("loading-hidden loading-open").removeClass("loading-close")},500)}function o(){a("#loading").toggleClass("loading-hidden"),setTimeout(function(){a("#loading").toggleClass("loading-open")},25)}function l(){a("#loading").addClass("loading-close"),setTimeout(function(){a("#loading").toggleClass("loading-hidden loading-open").removeClass("loading-close")},500)}function r(a,t){return a=a.filter(function(a){return a!==t})}function d(a,t){return a.find(function(a){return a===t})}function c(a){for(var t=[],e=0;e<a.length;e++)0===a[e].stock_qtty&&t.push(a[e].sku);return t}function u(t,e,s){var n=s;a.each(t,function(a,t){for(var s=t,i=0;i<s.skuAttrValues.length;i++){for(var o=s.skuAttrValues[i],l=s.attr_type,d=o.attr_value_id,c=o.skus,u=0;u<e.length;u++)c=r(c,e[u]);void 0===n[l]&&(n[l]={}),n[l][d]=c}})}function h(t,e){a.each(t,function(a,t){0!==t.stock_qtty&&(e[t.sku]=t.stock_qtty)})}function g(t,e){a.each(t,function(a,t){var s=t.vas_id,n=t.vas_type;e[s]=n})}function f(t){var e=t;if(P=[],1===e.length){var s=a(t).data("spa"),n=a(t).data("ska");return void(P=E[s][n])}for(var i=[],o=0;o<e.length;o++){var l=a(e[o]).data("ska"),r=a(e[o]).data("spa");i.push(E[r][l])}for(var c=[],u=0;u<e.length;u++){var h=[];if(0!==u){for(var g=0;g<i[u].length;g++){var f=d(c,i[u][g]);void 0!==f&&h.push(f)}c=h}else c=i[u]}P=c}function v(t){a.each(t,function(t,e){var s=E[e];a.each(s,function(t,e){for(var s=e,n=!1,i=0;i<s.length&&!n;i++)for(var o=0;o<P.length;o++)if(s[i]===P[o]){n=!0;break}n===!1?(a("#"+t).addClass("disabled"),a("#"+t).removeClass("active")):a("#"+t).removeClass("disabled")})})}function m(t,e,s){var n=E[e][s];1===t.length?a(".btn-itemProperty[data-spa="+t[0]+"]").removeClass("disabled"):a.each(t,function(t,s){var i=E[s];s!==e&&a.each(i,function(t,e){for(var s=e,i=!1,o=0;o<s.length&&!i;o++)for(var l=0;l<n.length;l++)if(s[o]===n[l]){i=!0;break}i===!1?(a("#"+t).addClass("disabled"),a("#"+t).removeClass("active")):a("#"+t).removeClass("disabled")})})}function p(t){var e=Object.keys(E),s={};s.select=[],s.wait=[];for(var n=0;n<t.length;n++){var i=a(t[n]).data("spa");s.select.push(i),e=r(e,i.toString())}return s.wait=e,s}function C(t){var e=Object.keys(E);if(1!==e.length){var s={};a.each(e,function(e,n){var i=a(t[e]).data("ska"),o=a(t[e]).data("spa");s[n]=E[o][i]}),a.each(e,function(t,e){var n=[];a.each(s,function(a,t){if(e!==a){var s=[];if(0===n.length)s=t;else for(var i=0;i<t.length;i++){var o=d(n,t[i]);void 0!==o&&s.push(o)}n=s}}),a.each(E[e],function(t,e){for(var s=!1,i=0;i<n.length&&!s;i++)for(var o=0;o<e.length;o++)if(e[o]===n[i]){s=!0;break}s===!1?(a("#"+t).addClass("disabled"),a("#"+t).removeClass("active")):a("#"+t).removeClass("disabled")})})}}function b(){var t=a(".btn-itemProperty.active"),e="";t.length>0?(a.each(t,function(a,s){e+=a===t.length-1?s.textContent.trim():s.textContent.trim()+","}),a("[data-select]").text("Selected:"),a("[data-select-options]").text(e)):(a("[data-select]").text("Select"),a("[data-select-options]").text(""))}function k(t){a.each(q,function(e,s){if(t==s.sku)return a("#skuNewPrice").html("$"+(s.skuPrice.sale_price/100).toFixed(2)),!1})}function y(t,e){var s=a(".warning-info");o(),a.ajax({url:"/stock/checkstock",data:{skus:t}}).done(function(a){if(a.success){var t=!0,n=parseInt(e.siblings("[data-num]").html());t=1===a.data.list[0].stockStatus,t===!1&&(s.removeClass("off"),s.children("span").html("Warning: Only "+n+" left"),e.addClass("disabled"))}}).always(function(){l()})}function w(){a.ajax({url:" /cart/amount",type:"GET"}).done(function(t){t.success&&(t.data.skusAmout>0&&t.data.skusAmout<=99?(a(".nav-shoppingCart").children("span").show(),a(".nav-shoppingCart").children("span").html(t.data.skusAmout)):t.data.skusAmout>99?(a(".nav-shoppingCart").children("span").show(),a(".nav-shoppingCart").children("span").html("99+")):a(".nav-shoppingCart").children("span").hide())})}function x(t){var r=a("#item-count").children("[data-num]").html(),d={sale_qtty:r,select:!0,sku:P[0],VAList:[]};a("#addToCart-sku").val(P[0]);var c=0,u=[];a.each(D,function(t,e){var s=a("#"+t);if(s.hasClass("active")){switch(u[c]={},u[c].vas_id=t,u[c].user_remark="",e){case 1:var n=s.siblings(".input-engraving").val();u[c].user_remark=n;break;case 2:}c++}}),onAddToCart(),d.VAList=u,o(),a.ajax({url:"/cart",type:t,data:{operate:d}}).done(function(o){o.success?(w(),a("[data-role]").removeClass("disabled"),""!==o.redirectUrl&&(window.location.href=o.redirectUrl),L.close(),"PATCH"===t&&(e(),setTimeout(function(){s()},1500))):(a("#error-info").text(o.error_msg),n(),setTimeout(function(){i()},1500))}).always(function(){l()})}function T(){var t=!0,e="";return a(".sparow").each(function(s){0!=a(this).data("click")&&"false"!=a(this).data("click")||(t=!1,e+=a(this).data("msg")+",")}),!!t||(a("#selectspa").html(e.substring(0,e.length-1)+" not selected"),a("#selectmsg").removeClass("loading-hidden"),setTimeout(function(){a("#selectmsg").addClass("loading-hidden")},1500),!1)}function A(a){for(var t="",e=0;e<a.length;e++)a.charCodeAt(e)>0&&a.charCodeAt(e)<255&&(t+=a.charAt(e));return t}function I(a){for(var t=A(a.val()),e=/^([a-z_A-Z-\/+0-9+\s]+)$/i,s=0;s<t.length;s++){var n=t.charAt(s);e.test(n)||(t=t.replace(n,""))}a.val(t)}function _(t){var e=window.setInterval(function(){t<=1&&(a(".limited-title").html("<strong>Pre Sale has ended</strong>"),a(".stock-qtty").html("Sold Out"),a("#limited-progress").attr("value","0"),a(".up-btn-addToBag").addClass("disabled"),a(".down-btn-addToBag").addClass("disabled"),clearInterval(e));var s=0,n=0,i=0,o=0;t>0&&(s=Math.floor(t/86400),n=Math.floor(t/3600)-24*s,i=Math.floor(t/60)-24*s*60-60*n,o=Math.floor(t)-24*s*60*60-60*n*60-60*i),F<2592e5?a(".time_show").html(24*s+n+"h: "+i+"m: "+o+"s"):a(".time_show").html(s+"d: "+n+"h: "+i+"m: "+o+"s"),t--,U=1e4*(1e3*t/G).toFixed(4),a("#limited-progress").attr("value",U)},1e3)}var j=new t("#baseImg-swiper",{pagination:"#baseImg-pagination",paginationType:"fraction",loop:!0,lazyLoading:!0,lazyLoadingInPrevNext:!0}),O=new t("#detailImg-swiper",{pagination:"#detailImg-pagination",paginationType:"fraction",loop:!0,lazyLoading:!0,lazyLoadingInPrevNext:!0}),P=[];1==[1==a(".sparow").length&&a(".skarow").length]&&(a(".sparow").data("click",!0),a(".skarow").addClass("active"),P[0]=a("[data-onlysku]").data("onlysku"),a("[data-select]").text("Selected:"),a("[data-select-options]").text(a(".skarow").html()));var M=[],S=[];O.params.control=j,j.params.control=O,a(".product-baseImg").on("click",function(){a(".product-detailImg").addClass("in"),a("body").addClass("no-scroll")}),a(".product-detailImg").on("click",function(){a(this).removeClass("in"),a("body").removeClass("no-scroll")});var q,z={closeOnOutsideClick:!1,closeOnCancel:!1,hashTracking:!1},L=a("[data-remodal-id=modal]").remodal(z),E={},B={},D={};!function(){var t=a("#modalDialog").data("spu");a.ajax({async:!1,url:"/products/"+t}).done(function(a){if(a.success){q=a.data.skuExps;var t=S=c(a.data.skuExps);void 0===a.data.spuAttrs||""==a.data.spuAttrs?P=a.data.skus:(M=a.data.spuAttrs,u(a.data.spuAttrs,t,E)),h(a.data.skuExps,B),g(a.data.vasBases,D)}})}(),a(".btn-itemProperty").on("click",function(t){var e=a(".warning-info");e.hasClass("off")||e.addClass("off");var s=a(t.target).data("spa"),n=a(t.target).data("ska");if(!a(t.target).hasClass("disabled")){a(t.target).hasClass("active")?(a("#spa"+s).data("click","false"),a(t.target).removeClass("active")):(a(t.target).parents(".row").find(".btn-itemProperty").removeClass("active"),a("#spa"+s).data("click","true"),a(t.target).addClass("active")),b();var i=a("#modalDialog").find(".btn-itemProperty.active"),o=Object.keys(E),l=a("#item-count"),r=p(i);if(l.children('[data-num="num"]').html(1),i.length===o.length){f(i),C(i);var d=B[P[0]];l.children('[data-item="minus"]').addClass("disabled"),l.children('[data-num="num"]').html(1),d>1&&l.children('[data-item="add"]').removeClass("disabled")}else i.length<1?(u(M,S,E),P=[]):(f(i),v(r.wait),m(r.select,s,n));void 0!=P[0]&&k(P[0])}}),a("#item-count").on("click","[data-item]",function(t){if(!T())return!1;var e=a(".warning-info"),s=a("#modalDialog").find(".btn-itemProperty.active"),n=Object.keys(E);if(!(n.length<s.length)){var i;if(i="I"===a(t.target)[0].tagName?a(t.target).parents(".btn-cartCount"):a(t.target),!i.hasClass("disabled")){var o=parseInt(i.siblings("[data-num]").html()),l=P[0],r=B[l],d=o++,c=d;if("add"===i.data("item")){c=o;var u=50;if(o>1&&i.siblings('[data-item="minus"]').removeClass("disabled"),o===u&&(e.removeClass("off"),e.children("span").html("50 items limit"),i.addClass("disabled")),r<20)o===r&&(e.removeClass("off"),e.children("span").html("Warning: Only "+o+" left"),i.addClass("disabled"));else if(20===r&&o>=20){var h=l+"_"+ ++o;y(h,i)}}else--d,e.addClass("off"),1===d?i.addClass("disabled"):i.siblings('[data-item="add"]').hasClass("disabled")&&i.siblings('[data-item="add"]').removeClass("disabled"),c=d;a("#addToCart-quantity").val(c),i.siblings("[data-num]").html(c)}}}),a('[data-role="continue"]').on("click",function(t){if(100!=a("#modalDialog").data("status")&&(a("#error-info").text("not invalid"),n(),setTimeout(function(){i()},1500)),T()){var e=a(t.target).data("action");x(e)}}),a('[data-control="openModal"]').on("click",function(t){if(!a(this).hasClass("disabled")){var e=Object.keys(E),s=Object.keys(D),n=a(t.target).data("action");0===e.length&&0===s.length&&0!==P.length?x(n):(a('[data-control="continue"]').removeClass("hidden-xs-up"),a('[data-control="modalButton"]').addClass("hidden-xs-up"),L.open(),a('[data-role="continue"]').data("action",n))}}),a("[data-remodal-id=modal]").on("closed",function(){a('[data-control="continue"]').addClass("hidden-xs-up"),a('[data-control="modalButton"]').removeClass("hidden-xs-up")}),a("fieldset[data-vas-type]").on("click",function(t){if(1===parseInt(a(this).data("vas-type")))if(a(t.target).hasClass("icon-checkcircle")){var e=a(t.target),s=a(t.target).siblings(".input-engraving");e.hasClass("active")?(s.addClass("disabled"),e.removeClass("active"),s.val("")):(s.removeClass("disabled"),e.addClass("active"))}else if(a(t.target).hasClass("input-engraving")){var e=a(t.target).siblings(".icon-checkcircle"),s=a(t.target);s.hasClass("disabled")&&(s.removeClass("disabled"),e.addClass("active"),s.val(""))}}),a(".input-engraving").on("keyup blur",function(){I(a(this))}),a(".btn-showMore").on("click",function(){var t=a(this).siblings(".message-info");t.toggleClass("active"),t.hasClass("active")?(a(this).addClass("off"),a(this).children(".showMore").html("Show Less"),a(this).children(".iconfont").removeClass("icon-arrow-bottom").addClass("icon-arrow-up")):(a(this).removeClass("off"),a(this).children(".showMore").html("Show More"),a(this).children(".iconfont").removeClass("icon-arrow-up").addClass("icon-arrow-bottom"))}),a(document).ready(function(){a(".message-info").children("p").height()<=64&&a(".btn-showMore").hide(),a("img.img-lazy").lazyload({threshold:200,effect:"fadeIn"}),a.ajax({url:a(".product-baseInfo").data("impr"),type:"GET"}),a.ajax({url:a("#recommend").data("impr"),type:"GET"})});var N=a(".limited-content").data("begintime"),V=a(".limited-content").data("endtime"),F=a(".limited-content").data("lefttime"),G=(a(".limited-content").data("qtty"),parseInt(V-N)),U=1e4*(F/G).toFixed(4);a("#limited-progress").attr("value",U),F!=-1&&a(function(){_(F/1e3)})}(jQuery,Swiper);