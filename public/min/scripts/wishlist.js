"use strict";!function(a){function t(){a(".wishloading").show()}function s(){a(".wishloading").hide()}function e(){a("#loading").toggleClass("loading-hidden"),setTimeout(function(){a("#loading").toggleClass("loading-open")},25)}function i(){a("#loading").addClass("loading-close"),setTimeout(function(){a("#loading").toggleClass("loading-hidden loading-open").removeClass("loading-close")},500)}function n(){a("#success").toggleClass("loading-hidden"),setTimeout(function(){a("#success").toggleClass("loading-open")},25)}function o(){a("#success").addClass("loading-close"),setTimeout(function(){a("#success").toggleClass("loading-hidden loading-open").removeClass("loading-close")},500)}function r(){a("#error").toggleClass("loading-hidden"),setTimeout(function(){a("#error").toggleClass("loading-open")},25)}function d(){a("#error").addClass("loading-close"),setTimeout(function(){a("#error").toggleClass("loading-hidden loading-open").removeClass("loading-close")},500)}function l(a,t){return a=a.filter(function(a){return a!==t})}function c(t){a.ajax({url:"/updateWish",type:"post",data:{spu:t}}).done(function(s){s.success?a('[data-wishspu="'+t+'"]').remove():(a("#error-info").text(s.error_msg),r(),setTimeout(function(){d()},1500))}).always(function(){a(".wishlist-item").length<=0&&G&&(a("#emptyWishlist").removeClass("hidden-xs-up"),G=!0)})}function u(){var e=a("#wishContainer"),i=e.data("wishpagenum");if(i!==-1&&e.data("loading")!==!0){e.data("loading",!0);var n=++i;t(),a.ajax({url:"/wish",data:{num:n,size:10,ajax:1}}).done(function(t){null===t.data||""===t.data?e.data("wishpagenum",-1):null===t.data.list||""===t.data.list||void 0===t.data.list||0===t.data.list.length?(e.data("wishpagenum",-1),G||(a("#emptyWishlist").removeClass("hidden-xs-up"),G=!0)):(G||(a("#emptyWishlist").addClass("hidden-xs-up"),G=!0),g("tpl-wishlist",t.data),e.data("wishpagenum",i),a("img.img-lazy").lazyload({threshold:200,effect:"fadeIn"}))}).always(function(){e.data("loading",!1),s()})}}function g(t,s){var e=template(t,s),i=a.parseHTML(e);a("#wishContainer").append(i)}function m(){var t=window.pageYOffset,s=a(document).height()-a(window).height();t!==s&s<=300+t&&u()}function h(t){var s=t.main_image_url;a("#productImg").attr("data-original","https://s3-us-west-1.amazonaws.com/emimagetest/n3/"+s),a("#productImg").attr("src","https://s3-us-west-1.amazonaws.com/emimagetest/n3/"+s);var e,i=0,n=0;""!=t.skuPrice.skuPromotion&&void 0!=t.skuPrice.skuPromotion&&"undefined"!=t.skuPrice.skuPromotion&&(i=(t.skuPrice.skuPromotion.price/100).toFixed(2),n=(t.skuPrice.skuPromotion.promot_price/100).toFixed(2)),e=(t.skuPrice.sale_price/100).toFixed(2),i>n?(a("#skuNewPrice").html("$"+n),a("#skuNewPrice").removeClass("text-primary"),a("#skuNewPrice").addClass("text-red"),a("#productPrice").html("$"+i)):(a("#skuNewPrice").html("$"+e),a("#skuNewPrice").removeClass("text-red"),a("#skuNewPrice").addClass("text-primary"),a("#productPrice").html("")),f("tpl-skuattrlist",t),v("tpl-vasbaseslist",t)}function f(t,s){var e=template(t,s),i=a.parseHTML(e);a("#product-skuAttr").html(i)}function v(t,s){var e=template(t,s),i=a.parseHTML(e);a("#product-vasBases").html(i)}function p(t,s,l){e();var u={sale_qtty:l,select:!0,sku:s,VAList:[]};a.ajax({url:"/cart",type:"PATCH",data:{operate:u}}).done(function(s){s.success?(C(),c(t),n(),setTimeout(function(){o()},1500)):(a("#error-info").text(s.error_msg),r(),setTimeout(function(){d()},1500))}).always(function(){i()})}function C(){a.ajax({url:" /cart/amount",type:"GET"}).done(function(t){t.success&&(t.data.skusAmout>0&&t.data.skusAmout<=99?(a(".nav-shoppingCart").children("span").show(),a(".nav-shoppingCart").children("span").html(t.data.skusAmout)):t.data.skusAmout>99?(a(".nav-shoppingCart").children("span").show(),a(".nav-shoppingCart").children("span").html("99+")):a(".nav-shoppingCart").children("span").hide())})}function k(a,t){return a.find(function(a){return a===t})}function w(a){for(var t=[],s=0;s<a.length;s++)0===a[s].stock_qtty&&t.push(a[s].sku);return t}function b(t,s){a.each(t,function(a,t){0!==t.stock_qtty&&(s[t.sku]=t.stock_qtty)})}function y(t,s){a.each(t,function(a,t){var e=t.vas_id,i=t.vas_type;s[e]=i})}function x(t){a.each(Q,function(s,e){if(t==e.sku)return a("#skuNewPrice").html("$"+(e.skuPrice.sale_price/100).toFixed(2)),!1})}function T(){var t=a(".btn-itemProperty.active"),s="";t.length>0?(a.each(t,function(a,e){s+=a===t.length-1?e.textContent.trim():e.textContent.trim()+","}),a("[data-select]").text("Selected:")):a("[data-select]").text("Select")}function P(t){var s=t;if(L=[],1===s.length){var e=a(t).data("spa"),i=a(t).data("ska");return void(L=E[e][i])}for(var n=[],o=0;o<s.length;o++){var r=a(s[o]).data("ska"),d=a(s[o]).data("spa");n.push(E[d][r])}for(var l=[],c=0;c<s.length;c++){var u=[];if(0!==c){for(var g=0;g<n[c].length;g++){var m=k(l,n[c][g]);void 0!==m&&u.push(m)}l=u}else l=n[c]}L=l}function _(t){var s=Object.keys(E);if(1!==s.length){var e={};a.each(s,function(s,i){var n=a(t[s]).data("ska"),o=a(t[s]).data("spa");e[i]=E[o][n]}),a.each(s,function(t,s){var i=[];a.each(e,function(a,t){if(s!==a){var e=[];if(0===i.length)e=t;else for(var n=0;n<t.length;n++){var o=k(i,t[n]);void 0!==o&&e.push(o)}i=e}}),a.each(E[s],function(t,s){for(var e=!1,n=0;n<i.length&&!e;n++)for(var o=0;o<s.length;o++)if(s[o]===i[n]){e=!0;break}e===!1?(a("#"+t).addClass("disabled"),a("#"+t).removeClass("active")):a("#"+t).removeClass("disabled")})})}}function A(t){var s=Object.keys(E),e={};e.select=[],e.wait=[];for(var i=0;i<t.length;i++){var n=a(t[i]).data("spa");e.select.push(n),s=l(s,n.toString())}return e.wait=s,e}function j(t,s,e){var i=e;a.each(t,function(a,t){for(var e=t,n=0;n<e.skuAttrValues.length;n++){for(var o=e.skuAttrValues[n],r=e.attr_type,d=o.attr_value_id,c=o.skus,u=0;u<s.length;u++)c=l(c,s[u]);void 0===i[r]&&(i[r]={}),i[r][d]=c}})}function z(t){a.each(t,function(t,s){var e=E[s];a.each(e,function(t,s){for(var e=s,i=!1,n=0;n<e.length&&!i;n++)for(var o=0;o<L.length;o++)if(e[n]===L[o]){i=!0;break}i===!1?(a("#"+t).addClass("disabled"),a("#"+t).removeClass("active")):a("#"+t).removeClass("disabled")})})}function I(t,s,e){var i=E[s][e];1===t.length?a(".btn-itemProperty[data-spa="+t[0]+"]").removeClass("disabled"):a.each(t,function(t,e){var n=E[e];e!==s&&a.each(n,function(t,s){for(var e=s,n=!1,o=0;o<e.length&&!n;o++)for(var r=0;r<i.length;r++)if(e[o]===i[r]){n=!0;break}n===!1?(a("#"+t).addClass("disabled"),a("#"+t).removeClass("active")):a("#"+t).removeClass("disabled")})})}function O(t,s){var n=a(".warning-info");e(),a.ajax({url:"/stock/checkstock",data:{skus:t}}).done(function(a){if(a.success){var t=!0,e=parseInt(s.siblings("[data-num]").html());t=1===a.data.list[0].stockStatus,t===!1&&(n.removeClass("off"),n.children("span").html("Warning: Only "+e+" left"),s.addClass("disabled"))}}).always(function(){i()})}function B(){var t=!0,s="";return a(".sparow").each(function(e){0!=a(this).data("click")&&"false"!=a(this).data("click")||(t=!1,s+=a(this).data("msg")+",")}),!!t||(a("#selectspa").html(s.substring(0,s.length-1)+" not selected"),a("#selectmsg").removeClass("loading-hidden"),setTimeout(function(){a("#selectmsg").addClass("loading-hidden")},1500),!1)}function D(t){1!=a("#addToCart-sku").val()&&(L[0]=a("#addToCart-sku").val());var s=a("#item-count").children("[data-num]").html(),l={sale_qtty:s,select:!0,sku:L[0],VAList:[]};a("#addToCart-sku").val(L[0]);var u=0,g=[];a.each(M,function(t,s){var e=a("#"+t);if(e.hasClass("active")){switch(g[u]={},g[u].vas_id=t,g[u].user_remark="",s){case 1:var i=e.siblings(".input-engraving").val();g[u].user_remark=i;break;case 2:}u++}}),l.VAList=g,e();var m=a("#modalDialog").data("spu");a.ajax({url:"/cart",type:t,data:{operate:l}}).done(function(t){t.success?(C(),S.close(),c(m),n(),setTimeout(function(){o()},1500)):(a("#error-info").text(t.error_msg),r(),setTimeout(function(){d()},1500))}).always(function(){i()})}function N(a){for(var t="",s=0;s<a.length;s++)a.charCodeAt(s)>0&&a.charCodeAt(s)<255&&(t+=a.charAt(s));return t}function q(a){for(var t=N(a.val()),s=/^([a-z_A-Z-\/+0-9+\s]+)$/i,e=0;e<t.length;e++){var i=t.charAt(e);s.test(i)||(t=t.replace(i,""))}a.val(t)}var L=[],W={closeOnOutsideClick:!1,closeOnCancel:!1,hashTracking:!1},H=a('[data-remodal-id="modal"]').remodal(W),S=a('[data-remodal-id="movetobagmodal"]').remodal(W),V=[],$=[],E={},F={},M={};a("#wishContainer").on("click",".delwish",function(t){a("#wishDialog").data("spu",a(t.target).data("spu")),H.open()}),a('[data-remodal-action="confirm"]').on("click",function(){var t=a("#wishDialog").data("spu");c(t)}),a('[data-remodal-action="cancel"]').on("click",function(){a("#wishDialog").data("spu",""),H.close()}),a(function(){a("img.img-lazy").lazyload({threshold:200,effect:"fadeIn"})});var G=!1;a(document).ready(function(){u(),a(window).scroll(function(){a("img.img-lazy").each(function(){var t=a(this).attr("src"),s=a(this).attr("data-original");t===s&&a(this).removeClass("img-lazy")}),m()})});var Q;a("#wishContainer").on("click",".btn-moveToBag",function(){a("#addToCart-name").val(a(this).data("name")),a("#addToCart-spu").val(a(this).data("spu")),a("#addToCart-price").val(a(this).data("price"));var t=a(this).data("spu");a.ajax({url:"/products/"+t}).done(function(s){var e=!1;if(""!=s.data.vasBases&&void 0!=s.data.vasBases&&"undefined"!=s.data.vasBases&&s.data.vasBases.length>0&&(e=!0),s.success){if(s.data.skus.length>1||e===!0){h(s.data),Q=s.data.skuExps;var i=$=w(s.data.skuExps);void 0===s.data.spuAttrs||""==s.data.spuAttrs?L=s.data.skus:(V=s.data.spuAttrs,j(s.data.spuAttrs,i,E)),b(s.data.skuExps,F),y(s.data.vasBases,M),1==[1==a(".sparow").length&&a(".skarow").length]&&(a(".sparow").data("click",!0),a(".skarow").addClass("active"),L[0]=s.data.skus[0],a("[data-select]").text("Selected:")),a("#modalDialog").data("spu",t),a("#modalDialog").data("status",s.data.status_code),S.open()}else{var n=s.data.skus[0];p(t,n,1)}onAddToCart()}}).always(function(){})}),a("#product-skuAttr").on("click",".btn-itemProperty",function(t){var s=a(this).data("image");void 0!=s&&""!=s&&(a("#productImg").attr("data-original","https://s3-us-west-1.amazonaws.com/emimagetest/n3/"+s),a("#productImg").attr("src","https://s3-us-west-1.amazonaws.com/emimagetest/n3/"+s));var e=a(".warning-info");e.hasClass("off")||e.addClass("off");var i=a(t.target).data("spa"),n=a(t.target).data("ska");if(!a(t.target).hasClass("disabled")){a(t.target).hasClass("active")?(a("#spa"+i).data("click","false"),a(t.target).removeClass("active")):(a(t.target).parents(".row").find(".btn-itemProperty").removeClass("active"),a("#spa"+i).data("click","true"),a(t.target).addClass("active")),T();var o=a("#modalDialog").find(".btn-itemProperty.active"),r=Object.keys(E),d=a("#item-count"),l=A(o);if(d.children('[data-num="num"]').html(1),o.length===r.length){P(o),_(o);var c=F[L[0]];d.children('[data-item="minus"]').addClass("disabled"),d.children('[data-num="num"]').html(1),c>1&&d.children('[data-item="add"]').removeClass("disabled")}else o.length<1?(j(V,$,E),L=[]):(P(o),z(l.wait),I(l.select,i,n));void 0!=L[0]&&(a("#addToCart-sku").val(L[0]),x(L[0]))}}),a("#item-count").on("click","[data-item]",function(t){if(!B())return!1;var s=a(".warning-info"),e=a("#modalDialog").find(".btn-itemProperty.active"),i=Object.keys(E);if(!(i.length<e.length)){var n;if(n="I"===a(t.target)[0].tagName?a(t.target).parents(".btn-cartCount"):a(t.target),!n.hasClass("disabled")){var o=parseInt(n.siblings("[data-num]").html()),r=L[0],d=F[r],l=o++,c=l;if("add"===n.data("item")){c=o;var u=50;if(o>1&&n.siblings('[data-item="minus"]').removeClass("disabled"),o===u&&(s.removeClass("off"),s.children("span").html("50 items limit"),n.addClass("disabled")),d<20)o===d&&(s.removeClass("off"),s.children("span").html("Warning: Only "+o+" left"),n.addClass("disabled"));else if(20===d&&o>=20){var g=r+"_"+ ++o;O(g,n)}}else--l,s.addClass("off"),1===l?n.addClass("disabled"):n.siblings('[data-item="add"]').hasClass("disabled")&&n.siblings('[data-item="add"]').removeClass("disabled"),c=l;a("#addToCart-quantity").val(c),n.siblings("[data-num]").html(c)}}}),a('[data-role="continue"]').on("click",function(t){if(1!=a("#addToCart-sku").val()&&1!=a("#modalDialog").data("login"))D("PATCH");else if(B()){var s=a(t.target).data("action");D(s)}}),a("#product-vasBases").on("click","fieldset[data-vas-type]",function(t){if(1===parseInt(a(this).data("vas-type")))if(a(t.target).hasClass("icon-checkcircle")){var s=a(t.target),e=a(t.target).siblings(".input-engraving");s.hasClass("active")?(e.addClass("disabled"),s.removeClass("active"),e.val("")):(e.removeClass("disabled"),s.addClass("active"))}else if(a(t.target).hasClass("input-engraving")){var s=a(t.target).siblings(".icon-checkcircle"),e=a(t.target);e.hasClass("disabled")&&(e.removeClass("disabled"),s.addClass("active"),e.val(""))}}),a("#product-vasBases").on("keyup blur",".input-engraving",function(){q(a(this))}),a("#close-movetobagmodal").on("click",function(){S.close()})}(jQuery);