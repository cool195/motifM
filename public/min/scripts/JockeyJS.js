!function(){for(var e=window.location.host,t={callbacks:{},send:function(e,t){this.dispatchMessage("event",e,t)},sendCallback:function(e){var t=n.createEnvelope(e);this.dispatchMessage("callback",t,function(){})},triggerCallback:function(e){var t=this;setTimeout(function(){t.callbacks[e]()},0)},dispatchMessage:function(e,t,i){var n=this;this.callbacks[t.id]=function(){i(),delete n.callbacks[t.id]};var a="jockey://"+e+"/"+t.id+"?"+encodeURIComponent(JSON.stringify(t)),s=document.createElement("iframe");s.setAttribute("src",a),document.documentElement.appendChild(s),s.parentNode.removeChild(s),s=null}},i={callbacks:{},send:function(e,t){this.dispatchMessage("jockeyEvent",e,t)},sendCallback:function(e){var t=n.createEnvelope(e);this.dispatchMessage("jockeyCallback",t,function(){})},triggerCallback:function(e){this.callbacks[e]&&this.callbacks[e]()},dispatchMessage:function(e,t,i){var a=this;this.callbacks[t.id]=function(){i(),delete a.callbacks[t.id]},n.targetWindow.postMessage({type:e,envelope:t},n.targetDomain)}},n={listeners:{},dispatchers:[],messageCount:0,targetDomain:"*",targetWindow:window.parent,on:function(e,t){(!this.listeners.hasOwnProperty(e)||!this.listeners[e]instanceof Array)&&(this.listeners[e]=[]),this.listeners[e].push(t)},off:function(e){(!this.listeners.hasOwnProperty(e)||!this.listeners[e]instanceof Array)&&(this.listeners[e]=[]),this.listeners[e]=[]},send:function(e,t,i){t instanceof Function&&(i=t,t=null),t=t||{},i=i||function(){};var n=this.createEnvelope(this.messageCount,e,t);this.dispatchers.forEach(function(e){e.send(n,i)}),this.messageCount+=1},trigger:function(e,t,i){for(var n=this,a=this.listeners[e]||[],s=0,o=function(){s+=1,s>=a.length&&n.dispatchers.forEach(function(e){e.sendCallback(t)})},c=0;c<a.length;c++){var r=a[c];r.length<=1?(r(i),o()):r(i,o)}},triggerCallback:function(e){this.dispatchers.forEach(function(t){t.triggerCallback(e)})},restrictIframeDispatcher:function(e,t){this.targetDomain=e,this.targetWindow=t},onMessageRecieved:function(e){if("*"==this.targetDomain||this.targetDomain==e.origin){var t=e.data.envelope;"jockeyEvent"==e.data.type?this.trigger(t.type,t.id,t.payload):"jockeyCallback"==e.data.type&&this.triggerCallback(e.data.envelope.id)}},createEnvelope:function(t,i,n){return{id:t,type:i,host:e,payload:n}}},a=0,s=!1,o=["iPad","iPhone","iPod"];a<o.length;a++)if(navigator.platform.indexOf(o[a])>=0){s=!0;break}var c=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent),r=navigator.userAgent.toLowerCase().indexOf("android")>-1;(s&&c||r)&&n.dispatchers.push(t),n.dispatchers.push(i),window.addEventListener("message",$.proxy(n.onMessageRecieved,n),!1),window.Jockey=n}();