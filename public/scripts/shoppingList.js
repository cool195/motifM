"use strict";!function(n,e){function a(e){c.slideTo(e,500,!1),r.slideTo(e,500,!1),n(c.slides).children("a").addClass("inactive"),n(c.slides[e]).children("a").removeClass("inactive")}function t(e){f.length=e,n.each(f,function(n){f[n]=0})}function i(){var e=window.pageYOffset,a=n(document).height()-n(window).height();e!==a&100+e>=a&&s()}function o(e){n(r.slides[e]).find(".loading").show()}function d(e){n(r.slides[e]).find(".loading").hide()}function l(e,a){var t=template("tpl-product",e),i=n.parseHTML(t);n(r.slides[a]).find("row").append(i)}function s(){var e=r.activeIndex,a=n(r.slides[e]);if(a.data("loading")!==!0&&(a.data("loading",!0),null!==f[e])){var t=f[e],i=++t,s=u[e].category_id;o(e),n.ajax({url:"/products",data:{pagenum:i,pagesize:20,cid:s}}).done(function(n){if(null!==n.data&&""!==n.data){if(0===n.data.list.length)return void(f[e]=null);l(n.data,e),f[e]++}}).always(function(){d(e),a.data("loading",!1)})}}n("#header").headroom({tolerance:.5,offset:44,classes:{top:"animated",notTop:"animated",bottom:"animated",notBottom:"animated",initial:"animated",pinned:"slideInDown",unpinned:"slideOutUp"}}),n("#tabIndex-container").headroom({tolerance:.5,offset:44,classes:{top:"animated",notTop:"animated",bottom:"animated",notBottom:"animated",initial:"animated",pinned:"tabIndexDown",unpinned:"tabIndexUp"}});var c=new e("#tabIndex-container",{freeMode:!0,slidesPerView:"auto",freeModeMomentumRatio:.5,onTap:function(){(n(event.target).is("li")||n(event.target).is("a")||n(event.target).is("span"))&&a(c.clickedIndex)}}),r=new e("#tabs-container",{onlyExternal:!0}),u=[],f=[];!function(){n.ajax({url:"/category"}).done(function(n){u=n.data.list,t(u.length),console.log("获取分类成功")})}(),n(document).ready(function(){n(window).scroll(i())}),n("#tabIndex-container").find("li[data-tabIndex]").one("click",function(){console.log("顶部切换, 触发选项卡loading, 一次性事件"),s()})}(jQuery,Swiper);